<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edward Brown - Demos</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        #game-container {
            width: 500px;
            height: 500px;
            margin: 0 auto;
            border: 2px solid red;
            background-color: #f0f0f0;
            position: relative;
        }
        #pyjsdl-canvas {
            display: block;
            margin: 0 auto;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
        }
    </style>
    
    <!-- Load PyJSDL in the head with defer attribute -->
    <script src="js/pyjsdl" defer></script>
</head>
<body>
    <header>
        <h1>Interactive Demos</h1>
        <nav>
            <ul>
                <li><a href="index.html">Return to Portfolio</a></li>
            </ul>
        </nav>
    </header>

    <section id="demos">
        <h2>Demos</h2>
        <div class="demo-grid">
            <div class="demo-tile">
                <h3>Isometric Building Game</h3>
                <div id="game-container">
                    <canvas id="pyjsdl-canvas"></canvas>
                    <div id="loading-indicator" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
                        Loading game...
                    </div>
                </div>
                <p>A simple Isometric building game with controllable camera and building mechanics.</p>
                <div class="controls-info">
                    <p><strong>Controls:</strong></p>
                    <ul>
                        <li>WASD - Move player</li>
                        <li>Arrow keys - Move camera</li>
                        <li>To build - left click</li>
                        <li>To move up - space bar</li>
                        <li>To move down - shift key</li>
                        <li>To swap material - press 1, 2 or 3</li>
                    </ul>
                </div>
            </div>
        </div>
        <button class="return-button" onclick="window.location.href='index.html'">Return to Portfolio</button>
    </section>

    <div id="demoModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-info">
                    <p>Press 'Esc' key or the Close button to exit the demo</p>
                    <p><strong>Controls:</strong></p>
                    <ul>
                        <li>WASD - Move player</li>
                        <li>Arrow keys - Move camera</li>
                        <li>To build - left click</li>
                        <li>To move up - space bar</li>
                        <li>To move down - shift key</li>
                        <li>To swap material - press 1, 2 or 3</li>
                    </ul>
                </div>
                <button onclick="closeDemo()" class="close-button">Close Demo</button>
            </div>
            <div id="demoContainer"></div>
        </div>
    </div>

    <script>
        // Wait until both the page and PyJSDL are fully loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOM loaded, checking for PyJSDL...");
            
            // Function to check if PyJSDL is loaded
            function checkPyJSDL() {
                if (typeof PyJSDL !== 'undefined') {
                    console.log("PyJSDL found, initializing game...");
                    initGame();
                } else {
                    console.log("PyJSDL not found yet, waiting...");
                    setTimeout(checkPyJSDL, 100); // Check again in 100ms
                }
            }
            
            // Initialize the game once PyJSDL is available
            function initGame() {
                try {
                    console.log("Initializing PyJSDL");
                    PyJSDL.init("pyjsdl-canvas", {
                        width: 500,
                        height: 500,
                        backgroundColor: '#ffffff'
                    });
                    console.log("PyJSDL initialized");
                    
                    // Add error handler
                    PyJSDL.onerror = function(error) {
                        console.error("PyJSDL error:", error);
                        document.getElementById('loading-indicator').textContent = 'Error loading game. Check console for details.';
                    };
                    
                    // Make sure path is correct relative to demos.html
                    console.log("Loading game from:", "iso6c.py");
                    PyJSDL.load("isopythondemo/iso6c.py").then(() => {
                        console.log("Game loaded successfully");
                        document.getElementById('loading-indicator').style.display = 'none';
                    }).catch(error => {
                        console.error("Failed to load game:", error);
                        document.getElementById('loading-indicator').textContent = 'Failed to load game. Check console for details.';
                    });
                } catch (e) {
                    console.error("Setup error:", e);
                    document.getElementById('loading-indicator').textContent = 'Setup error. Check console for details.';
                }
            }
            
            // Start checking for PyJSDL
            checkPyJSDL();
        });

        function openDemo(demoUrl) {
            const modal = document.getElementById('demoModal');
            const demoContainer = document.getElementById('demoContainer');
            
            const iframe = document.createElement('iframe');
            iframe.src = demoUrl;
            iframe.width = "800";
            iframe.height = "600";
            iframe.frameBorder = "0";
            iframe.allowFullscreen = true;
            iframe.allow = "keyboard-map *";
            iframe.tabIndex = "1";
            
            demoContainer.innerHTML = '';
            demoContainer.appendChild(iframe);
            
            modal.style.display = 'block';
            
            setTimeout(() => {
                iframe.focus();
            }, 100);
        }

        function closeDemo() {
            const modal = document.getElementById('demoModal');
            const demoContainer = document.getElementById('demoContainer');
            
            demoContainer.innerHTML = '';
            modal.style.display = 'none';
        }

        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeDemo();
            }
        });
    </script>
</body>
</html>